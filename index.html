<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Betting Odds Tracker</title>
    <link rel="stylesheet" href="static/css/styles.css">
    <script>
        async function fetchData(file, tableId) {
            try {
                const response = await fetch("static/data/" + file);
                if (!response.ok) {
                    throw new Error("Failed to load " + file);
                }
                const data = await response.json();
                displayTable(data, tableId);
            } catch (error) {
                document.getElementById(tableId).innerHTML = `<p class="error">Error loading data.</p>`;
                console.error(error);
            }
        }

        async function loadLastUpdated(datetimeId) {
            try {
                const response = await fetch("static/data/last_updated.txt");
                if (!response.ok) {
                    throw new Error("Failed to load last updated time.");
                }
                const lastUpdated = await response.text();
                document.getElementById(datetimeId).innerHTML = `Data last updated on: ${lastUpdated}`;
            } catch (error) {
                document.getElementById(datetimeId).innerHTML = "Last updated time not available.";
                console.error(error);
            }
        }
    
        function displayTable(data, tableId) {
            if (!data.length) {
                document.getElementById(tableId).innerHTML = "<p>No data available</p>";
                return;
            }
            
            const table = document.createElement("table");
            const thead = document.createElement("thead");
            const tbody = document.createElement("tbody");
    
            // Table headers, excluding game_id
            const headers = Object.keys(data[0]).filter(key => key !== "game_id");
            const headerRow = document.createElement("tr");
            headers.forEach(header => {
                const th = document.createElement("th");
                th.textContent = header;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
    
            // Table body
            data.forEach(row => {
                const tr = document.createElement("tr");
                headers.forEach(header => {
                    const td = document.createElement("td");
                    td.textContent = row[header] ?? 'N/A'; // In case any field is missing
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
    
            table.appendChild(thead);
            table.appendChild(tbody);
            document.getElementById(tableId).innerHTML = "";
            document.getElementById(tableId).appendChild(table);
        }

        window.onload = function () {
            fetchData("better_odds.json", "betterOddsContainer");
            fetchData("results.json", "resultsContainer");
            loadLastUpdated("scrapedDatetime");  // Load the last updated time from last_updated.txt
        };
    </script>
</head>
<body>
    <h1>Betting Odds Tracker</h1>
    
    <!-- Display the scraped date and time once at the top -->
    <div id="scrapedDatetime">Loading last updated time...</div>
    <!-- Better Odds Than Average -->
    <h2>Better Odds Than Average</h2>
    <div class="description">
        <p>
            The <strong>Better Odds Than Average</strong> table highlights situations where a bookmaker offers odds that are stronger than the market average for a given game and outcome. 
            By comparing individual bookmaker lines against the consensus, this table helps identify potential value bets where the odds are more favorable than what most sportsbooks provide.
        </p>
        <details>
            <summary><strong>Column Explanations</strong></summary>
            <ul>
                <li><strong>Bookmaker</strong> – The sportsbook offering the better-than-average odds.</li>
                <li><strong>American Odds</strong> – The odds provided by that bookmaker in American format (+/-).</li>
                <li><strong>Average American Odds</strong> – The average odds across all bookmakers.</li>
                <li><strong>Difference</strong> – The gap between the bookmaker’s odds and the overall market average.</li>
                <li><strong>Implied Probability</strong> – The win probability implied by the bookmaker’s odds.</li>
                <li><strong>Average Implied Probability</strong> – The market average of the implied probabilities across all bookmakers.</li>
                <li><strong>Implied Probability Difference</strong> – The difference between the bookmaker’s implied probability and the market average.</li>
            </ul>
        </details>
    </div>
    <div id="betterOddsContainer">Loading...</div>

    <!-- Best Odds per Game -->
    <h2>Best Odds per Game</h2>
    <div class="description">
        <p>
            The <strong>Best Odds per Game</strong> table shows the most favorable odds available for each team across all bookmakers. 
            By comparing the top odds for both the home and away teams, this table helps bettors maximize potential returns. 
            It can also highlight possible arbitrage opportunities when differences between bookmakers’ odds are large enough to secure a guaranteed profit.
        </p>
        <details>
            <summary><strong>Column Explanations</strong></summary>
            <ul>
                <li><strong>Home Team / Away Team</strong> – The two teams in the matchup.</li>
                <li><strong>Max Home Bookmaker</strong> – The sportsbook offering the best odds for the home team.</li>
                <li><strong>Max Home Odds</strong> – The best available odds for the home team.</li>
                <li><strong>Mean Home Odds</strong> – The average odds for the home team across all bookmakers.</li>
                <li><strong>Max Away Bookmaker</strong> – The sportsbook offering the best odds for the away team.</li>
                <li><strong>Max Away Odds</strong> – The best available odds for the away team.</li>
                <li><strong>Mean Away Odds</strong> – The average odds for the away team across all bookmakers.</li>
                <li><strong>Difference</strong> – The spread between the best home and away odds, useful for spotting large discrepancies.</li>
            </ul>
        </details>
    </div>
    <div id="resultsContainer">Loading...</div>
</body>
</html>